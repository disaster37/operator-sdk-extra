# Sample with memcached operator

We will rewrite the sample of memcached-operator with the extended framework.

## Create project

```bash
operator-sdk init --domain=example.com --repo=github.com/disaster37/operator-sdk-extra/testdata/memcached-operator

operator-sdk create api --group cache --version v1alpha1 --kind Memcached --resource --controller
```

## Use operator-sdk-extra

### Resources (CRD)

- First, you need to implements the interface `controller.MultiPhaseObject` on `api/v1alpha1/memcached_types`. Just need to herit of `controller.BasicMultiPhaseObject`

### Reconciler steps

For each resources, the controller need to reconcile them. So you need to create a dedicated step. To do that, you need to implement the interface  `controller.MultiPhaseStepReconciler`. Just need to herit of `controller.BasicMultiPhaseStepReconciler`.

You can look on  `controllers/configmap_reconciler.go` and `controllers/deployement_reconciler.go`. Moreover, to simplify the code reader, we create a builder to generate expected K8s object. You can look on `controllers/configmap_builder.go` and  `controllers/deployment_builder.go`

To finished, you need to patch the controller generated by the framework. You can look on `controllers/memcached_controller.go`. The controller need to implement the interface  `controller.MultiPhaseReconciler`. Just need to herit of `controller.BasicMultiPhaseReconciler`